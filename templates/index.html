<!doctype html>
<html>

    <head>

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <link rel="stylesheet" href="\static\style.css">
        <script src="C:\Users\ibrah\OneDrive\Documenten\GitHub\Project-D-Groep-3\server.py"></script>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <script>
                
            function uploadFiles() {
                var files = document.getElementById('file_upload').files;
                if(files.length==0){
                    alert("Please first choose or drop any file(s)...");
                    return;
                }

                var filenames="";
                for(var i=0;i<files.length;i++){
                    filenames+=files[i].name+"\n";
                }
                alert("Selected file(s) :\n____________________\n"+filenames);
            }
                    
        </script>
    </head>

    <body id="body">
        
        <nav>
            <!-- https://www.bol.com/nl/nl/ -->
            <a href="/"> <img class="logo" src="\static\logo\bollogo.jfif"> </a>
            

            <ul>
                <li><a href="https://www.bol.com">Home</a></li>
                <li><a href="https://pers.bol.com/nl/nieuws/">News</a></li>
                <li><a href="https://www.bol.com/nl/nl/m/klantenservice/">Contact</a></li>
                <li><a href="https://www.bol.com/nl/nl/m/over-bol-com/">About</a></li>
            </ul>
    
            <table class="navswitch"> 
                <tr>
    
                    <td><p class="switchtxt">High Contrast</p></td>
                    <td>
                        <label id="hcswitch" class="switch">
                            <input type="checkbox" onclick="contrastSwitchfunction()">
                            <span class="slider"></span>
                        </label>
                    </td>
             
                </tr>
                
                <script>
                    var contrastSwitch = false;

                    console.log(document.cookie);
                    if(document.cookie == "HC=true"){
                        document.getElementById("hcswitch").click();
                        contrastSwitch = true;
                    }
                    
                    function contrastCheck(){
                        var body = document.getElementById("body");
                        var uploadedtexthc = document.getElementById("uploadedText");
                        var imagereturntexth = document.getElementById("imagereturnText");
                        var uploadbuttonhc = document.getElementById("uploadbtton")
                        var toptexthc = document.getElementById("toptxt-hc");

                        var cardtexthc = document.getElementsByClassName("product-cardhcID");

                        console.log(contrastSwitch);

                        if (!contrastSwitch){
                            body.classList.remove("body-highcontrast");
                            if(uploadbuttonhc != undefined){
                                uploadbuttonhc.classList.remove("upload-buttonhc");
                            }

                            if(uploadedtexthc != undefined){
                                uploadedtexthc.classList.remove("uploaded-text");
                                imagereturntexth.classList.remove("imagereturn-text");                         
                            }

                            if(toptexthc != undefined){
                                toptexthc.classList.remove("toptexthc");
                            }
                                
                                for(let x of cardtexthc){
                                    x.classList.remove("product-cardhc");
                                }
                        }
                        else {
                            body.classList.add("body-highcontrast");
                            if(uploadbuttonhc != undefined){
                                uploadbuttonhc.classList.add("upload-buttonhc");
                            }

                            if(toptexthc != undefined){
                                toptexthc.classList.add("toptexthc");
                            }

                            if(uploadedtexthc != undefined){
                                uploadedtexthc.classList.add("uploaded-text");
                                imagereturntexth.classList.add("imagereturn-text");

                                for(let x of cardtexthc){
                                    x.classList.add("product-cardhc");
                                }
                            }
                        }
                    }

                    function contrastSwitchfunction(){ 
                        var body = document.getElementById("body");
                        var uploadedtexthc = document.getElementById("uploadedText");
                        var imagereturntexth = document.getElementById("imagereturnText");
                        var uploadbuttonhc = document.getElementById("uploadbtton")
                        var toptexthc = document.getElementById("toptxt-hc");

                        var cardtexthc = document.getElementsByClassName("product-cardhcID");

                        console.log(contrastSwitch);

                        if (contrastSwitch){
                            body.classList.remove("body-highcontrast");
                            if(uploadbuttonhc != undefined){
                                uploadbuttonhc.classList.remove("upload-buttonhc");
                            }

                            if(uploadedtexthc != undefined){
                                uploadedtexthc.classList.remove("uploaded-text");
                                imagereturntexth.classList.remove("imagereturn-text");                         
                            }

                            if(toptexthc != undefined){
                                toptexthc.classList.remove("toptexthc");
                            }
                                
                                for(let x of cardtexthc){
                                    x.classList.remove("product-cardhc");
                                }
                            

                            contrastSwitch = false;
                            document.cookie = "HC=false";
                        }
                        else {
                            body.classList.add("body-highcontrast");
                            if(uploadbuttonhc != undefined){
                                uploadbuttonhc.classList.add("upload-buttonhc");
                            }

                            if(toptexthc != undefined){
                                toptexthc.classList.add("toptexthc");
                            }

                            if(uploadedtexthc != undefined){
                                uploadedtexthc.classList.add("uploaded-text");
                                imagereturntexth.classList.add("imagereturn-text");

                                for(let x of cardtexthc){
                                    x.classList.add("product-cardhc");
                                }
                            }

                            contrastSwitch = true;
                            document.cookie = "HC=true";
                        }
                    }
                </script>
                <tr>
    
                    <td><p class="switchtxt">Text-to-Speech</p></td>
                    <td>
                        <label class="switch">
                            <input type="checkbox" onclick="setTTS()">
                            <span class="slider"></span>
                        </label>
                    </td>
    
                </tr>
            </table>
    
        </nav>

        
        <div class="container">

            <div id="toptxt-hc" class="toptxt">
                <h1>Bol.com Visual Search</h1>
            </div>
            
        
            <script type="text/javascript">
                var tts = false;
                var selectShirt = false;
                var countProduct = 0;  
                var product= Audio;  
                var jsonobj =[];
                var size =9
            
            
                function setTTS(){
                    tts = !tts;
                }
                function play(id){
                    if (tts) {
                        product = new Audio(id);
                        product.play();
                    }
                }
                function pause(){
                    if (tts) {
                        product.pause();
                    }
                }
              
            
                document.forms['upload-container'].addEventListener('submit', function (event) {
                    
                    event.preventDefault();/*w  w w.  j av  a2s.c  o  m*/
                });
                const targetDiv = document.querySelector("upload-container")
                const btn = document.getElementById("uploadbtton");
                
                function hideForm() {
                    console.log("hideform");
                if (targetDiv.style.display !== "none") {
                    targetDiv.style.display = "none";
                } else {
                    targetDiv.style.display = "block";
                }
                };
            </script>
                
                
        
            <div class="main">
                <div id="uploadContainerhc" class="upload-container">
                    <form method="POST" enctype="multipart/form-data" id="uploadForm" onsubmit="hideForm()">
                        <input type="file" id="file_upload" name="query_img" class="vak"/>
                        <div class="submitbutton">
                            <input type="submit" class="button" id="uploadbtton"/>
                        </div>
                    </form>
                </div>

                {% if scores %}
                <h2 id="uploadedText">Uploaded:</h2>

                <script>
                    let el = document.querySelector(".upload-container")
                    el.remove()
                </script>

                {% endif %}

                {% if query_path %}
                <img src="{{ query_path }}" height="200px">
                {% endif %}

                {% if scores %}
                    {% if scores != 1 %}
                    <h2 id="imagereturnText">Your image returned these products:</h2>

                    <div id="scroller">
                        <div class="product-list" id="p-list">       
                            <template id ="product-template">
                                <div id="product-cardhc" class="product-cardhcID product-card">
                                    <p id="name"></p>
                                    <a id = "product-page"> 
                                        <img class ="img" id ="p-img" onmouseover= play(this.name) onmouseout="pause()"> 
                                    </a>
                                        <p class="price" id="price"></p>
                                </div>
                                <audio id="audio"></audio>
                            </template>
                        </div>
                        <div id="sentinel" class = "d-flex">
                            <div class="spinner-border" role="status"> </div>
                        </div>
                    </div>
                    {% else %}
                    <h2>Could not retrieve any results</h2>
                    {% endif %}
                {% endif %}
                
                <script type="text/javascript">

                var scroller = document.getElementById('scroller');
                var template = document.getElementById('product-template');
                var sentinel = document.getElementById('sentinel');
                var productlist = document.getElementById('p-list');

                function loadProducts(){
                    console.log("Retrieving data function");

                    fetch('../static/declare.json')
                        .then(resp=>resp.json())
                        .then(data =>{
                            console.log(data);
                            for(i=0; i<size;i++)
                            {

                                let product = template.content.cloneNode(true);

                                product.querySelector("#name").innerHTML = data[countProduct].name;
                                product.querySelector("#product-page").href= data[countProduct].page;
                                product.querySelector("#p-img").src = data[countProduct].img;
                                product.querySelector("#p-img").name = data[countProduct].mp3;

                                console.log("cropping image");
                                var url = data[countProduct].img;
                                const urlArr = url.split("/");
                                var Size = urlArr[urlArr.length - 1].split(".")[0];
                                var Width = parseInt(Size.split("x")[0]);
                                var Height = parseInt(Size.split("x")[1]);
                                if(Height >= Width)
                                    product.querySelector('#p-img').style.height = "300px";
                                else
                                    product.querySelector('#p-img').style.width = "300px";

                                product.querySelector("#price").innerHTML = data[countProduct].price;
                                product.querySelector("#audio").src=data[countProduct].mp3;
                                productlist.appendChild(product);
                                countProduct++;

                                console.log("Element appended");
                                contrastCheck();
                            }
                    });
                }


                let options = { rootMargin: '0px',threshold: 1.0}
                var observer = new IntersectionObserver(e => {
                    if(e[0].intersectionRatio<=0){
                        return;
                    }
                    console.log("doingitsthing");
                    console.log(e[0].intersectionRatio);
                    return loadProducts();
                    },options);
                observer.observe(sentinel);
                </script>
                <script>contrastCheck();</script>
            </div> 
        </div>
    </body>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</html>
